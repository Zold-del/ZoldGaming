<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Contrôles Tactiles - BLOCKDROP</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/tetromino-styles.css">
</head>
<body>
    <div id="app">
        <div class="game-container">
            <div class="game-board">
                <div class="grid" id="blockdrop-grid">
                    <!-- Grille de jeu sera créée dynamiquement -->
                </div>
            </div>

            <div class="game-info">
                <div class="game-title-container">
                    <div class="game-title">BLOCKDROP</div>
                    <div style="color: var(--primary); font-size: 0.8rem; margin-top: 1rem;">Test Contrôles Tactiles</div>
                </div>

                <div class="next-piece">
                    <div class="next-piece-title">PROCHAINE</div>
                    <div class="next-piece-container" id="next-piece"></div>
                </div>

                <div class="score-panel">
                    <div class="score-title">SCORE</div>
                    <div class="score-value" id="score-value">0</div>
                </div>

                <div class="level-panel">
                    <div class="level-title">NIVEAU</div>
                    <div class="level-value" id="level-value">1</div>
                </div>

                <div class="level-panel">
                    <div class="level-title">LIGNES</div>
                    <div class="level-value" id="lines-value">0</div>
                </div>

                <div class="controls-hint">
                    <strong>Contrôles Tactiles:</strong><br>
                    ← → : Déplacer<br>
                    ↻ : Rotation<br>
                    ↓ : Hard Drop<br>
                    Swipe gauche/droite: Déplacer<br>
                    Swipe bas: Soft Drop<br>
                    Tap rapide: Rotation
                </div>
            </div>
        </div>

        <!-- Boutons de test -->
        <div style="text-align: center; margin: 2rem 0; padding: 1rem; background: var(--dark); border-radius: 8px;">
            <button id="start-test" style="margin: 0.5rem; padding: 1rem 2rem; font-size: 1.2rem;">Démarrer Test</button>
            <button id="pause-test" style="margin: 0.5rem; padding: 1rem 2rem; font-size: 1.2rem;">Pause/Reprendre</button>
            <button id="reset-test" style="margin: 0.5rem; padding: 1rem 2rem; font-size: 1.2rem;">Réinitialiser</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/Utilities.js"></script>
    <script src="js/Tetromino.js"></script>
    <script src="js/GameBoard.js"></script>
    <script src="js/GameEngine.js"></script>

    <script>
        // Test des contrôles tactiles
        let gameEngine = null;
        let gameArea = null;

        function initTest() {
            // Crée la grille
            gameArea = document.getElementById('blockdrop-grid');
            for (let y = 0; y < 20; y++) {
                for (let x = 0; x < 10; x++) {
                    const cell = Utilities.createElement('div', {
                        class: 'cell',
                        dataset: { x: x, y: y }
                    });
                    gameArea.appendChild(cell);
                }
            }

            // Initialise le moteur de jeu
            gameEngine = new GameEngine();

            // Configure les callbacks
            gameEngine.onRender = (board, currentPiece) => {
                renderGame(board, currentPiece);
            };

            gameEngine.onScoreUpdate = (score, lines, level) => {
                document.getElementById('score-value').textContent = score;
                document.getElementById('lines-value').textContent = lines;
                document.getElementById('level-value').textContent = level;
            };

            gameEngine.onNextPieceUpdate = (nextPiece) => {
                renderNextPiece(nextPiece);
            };

            gameEngine.onGameOver = (score, lines, level) => {
                alert(`Game Over!\nScore: ${score}\nLignes: ${lines}\nNiveau: ${level}`);
            };

            // Démarre le jeu
            gameEngine.init(gameArea);

            console.log('Test des contrôles tactiles initialisé');
        }

        function renderGame(board, currentPiece) {
            const cells = gameArea.childNodes;

            // Nettoie la grille
            cells.forEach(cell => {
                cell.className = 'cell';
            });

            // Dessine les pièces fixées
            for (let y = 0; y < board.height; y++) {
                for (let x = 0; x < board.width; x++) {
                    if (board.grid[y][x] !== null) {
                        const index = y * board.width + x;
                        cells[index].className = `cell tetromino tetromino-${board.grid[y][x].toLowerCase()}`;
                    }
                }
            }

            // Dessine la pièce actuelle
            if (currentPiece) {
                const shape = currentPiece.getCurrentShape();
                for (let y = 0; y < shape.length; y++) {
                    for (let x = 0; x < shape[y].length; x++) {
                        if (shape[y][x]) {
                            const boardX = currentPiece.x + x;
                            const boardY = currentPiece.y + y;

                            if (boardY >= 0 && boardY < board.height &&
                                boardX >= 0 && boardX < board.width) {
                                const index = boardY * board.width + boardX;
                                cells[index].className = `cell tetromino tetromino-${currentPiece.type.toLowerCase()}`;
                            }
                        }
                    }
                }
            }
        }

        function renderNextPiece(nextPiece) {
            const container = document.getElementById('next-piece');
            if (!container || !nextPiece) return;

            container.innerHTML = '';

            const grid = Utilities.createElement('div', {
                style: 'display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr); width: 100%; height: 100%;'
            });

            for (let i = 0; i < 16; i++) {
                grid.appendChild(Utilities.createElement('div', { class: 'cell' }));
            }

            const shape = nextPiece.shapes[0];
            for (let y = 0; y < Math.min(shape.length, 4); y++) {
                for (let x = 0; x < Math.min(shape[y].length, 4); x++) {
                    if (shape[y][x]) {
                        const index = y * 4 + x;
                        grid.childNodes[index].className = `cell tetromino tetromino-${nextPiece.type.toLowerCase()}`;
                    }
                }
            }

            container.appendChild(grid);
        }

        // Écouteurs d'événements pour les boutons de test
        document.getElementById('start-test').addEventListener('click', () => {
            if (!gameEngine) {
                initTest();
            }
        });

        document.getElementById('pause-test').addEventListener('click', () => {
            if (gameEngine) {
                gameEngine.togglePause();
            }
        });

        document.getElementById('reset-test').addEventListener('click', () => {
            if (gameEngine) {
                gameEngine.resetGame();
            }
        });

        // Démarre automatiquement sur mobile
        if (window.innerWidth <= 768 || 'ontouchstart' in window) {
            setTimeout(() => {
                initTest();
            }, 1000);
        }
    </script>
</body>
</html>